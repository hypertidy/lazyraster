<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate Raster Data Lazily from GDAL  • lazyraster</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Generate Raster Data Lazily from GDAL ">
<meta property="og:description" content="Read raster data at a specified resolution on-demand. Augments
 the raster package by never reading data from a GDAL source until absolutely
 necessary for generating an in-memory raster object. A lazyraster object
 may be cropped and turned into a raster object, and by default will only 
 read a small amount of data sufficient for a an overall summary. The amount 
 of data read can be controlled by specifying the output dimensions. ">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">lazyraster</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/lazyraster">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="lazyraster" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#lazyraster" class="anchor"></a>lazyraster</h1></div>
<p>The goal of lazyraster is to get raster data on demand at the right resolution. This means that you can define a graphics device and then stream just the right amount of pixels to fill it from a GDAL data source.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The package can be installed from Github.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">## install.packages("remotes")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">remotes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span>(<span class="st">"hypertidy/lazyraster"</span>)</a></code></pre></div>
<p>See <a href="https://github.com/hypertidy/vapour">vapour</a> for more on the prerequisites.</p>
</div>
<div id="details" class="section level2">
<h2 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h2>
<p>There are functions <code><a href="reference/lazyraster.html">lazyraster()</a></code> to act like the <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster()</a></code> function and provide information but no data, and <code><a href="reference/lazyraster-raster-S4.html">crop()</a></code> to act like <code><a href="https://rdrr.io/pkg/raster/man/crop.html">raster::crop()</a></code> and then <code>as_raster</code> to break the lazy chain and build an actual raster object. The size of the currently open (or latent-default) device is used as a reasonable size for the output grid, but can be controlled by argument <code>dim</code>.</p>
<p>When the data is read <code>lazyraster</code> can specify the exact dimensions of the output raster, and by default a reasonable guess at the number of pixels required to fill the current device is used.</p>
<p>A variety of resampling algorithms are available (nearest neighbour is the default, <a href="https://github.com/hypertidy/vapour/blob/master/R/raster-input.R#L9">see this list for more</a>) and will be applied to reduce or increase the resolution.</p>
</div>
<div id="limitations" class="section level2">
<h2 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h2>
<p>We can’t utilize the RasterIO level-of-detail functionality for non-GDAL sources.</p>
<p>We can only access a single band.</p>
<p>We can’t control the details of the data type.</p>
</div>
<div id="gdal" class="section level2">
<h2 class="hasAnchor">
<a href="#gdal" class="anchor"></a>GDAL</h2>
<p>This uses a standard internal functionality of GDAL, the <a href="https://gdal.org/doxygen/classGDALRasterBand.html">RasterIO function of the GDALRasterBand</a>. This is used in a lot of different software, and is obviously pretty robust and well tested by the GDAL community, but I only really have experience with one product (commercial, now defunct) that used it extensively for live interactive visualization and data streaming. I haven’t found any problems with it at all using it in R, but the support for it is very minimal. You can access it indirectly using <code><a href="https://rdrr.io/pkg/rgdal/man/readGDAL.html">rgdal::readGDAL</a></code> for the underlying function, as the <code>raster</code> package does.</p>
</div>
<div id="vapour" class="section level2">
<h2 class="hasAnchor">
<a href="#vapour" class="anchor"></a>vapour</h2>
<p>To make this work we use the GDAL package <a href="https://github.com/hypertidy/vapour">vapour</a>. All of the ease-of-use code is in this package, <code>vapour</code> is pointedly bare-bones and provides very little interpretation of a data source because it is designed for use in development.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>Connect lazily to a GeoTIFF, see details of what’s there, crop to a section and then read it in and plot.</p>
<p>This is not a huge file, but is easily accessible and demonstrates the idea.</p>
<p>First we connect to a source and show two versions, the first is information about the data in its native form (286 rows and 143 columns), and then an actual RasterLayer but at a very small requested size (24 rows by 12 columns).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">sstfile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/sst.tif"</span>, <span class="dt">package =</span> <span class="st">"vapour"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lazyraster)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Attaching package: 'lazyraster'</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; The following object is masked from 'package:graphics':</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;     plot</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">lazy &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster.html">lazyraster</a></span>(sstfile)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">lazy <span class="co">## stay lazy</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; class         : LazyRaster</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; dimensions    : 286, 143 (nrow, ncol)</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; resolution    : 0.07000000, 0.07000389 (x, y)</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; extent        : 140.00000, 150.01000, -60.01833, -39.99722 (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; crs           : &lt;placeholder&gt;</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; values        : NA, NA (min, max - range from entire extent)</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; window extent : &lt;whole extent&gt;</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; window index  : &lt;-&gt;</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">## be only so lazy</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(lazy, <span class="dt">dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">12</span>, <span class="dv">24</span>))</a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; class      : RasterLayer </span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; dimensions : 24, 12, 288  (nrow, ncol, ncell)</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; resolution : 0.8341667, 0.834213  (x, y)</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; extent     : 140, 150.01, -60.01833, -39.99722  (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; crs        : NA </span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; source     : memory</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt; names      : layer </span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#&gt; values     : -3.4e+38, 289.478  (min, max)</span></a></code></pre></div>
<p>The call to <code>as_raster</code> read actual data from the file, hence the difference between the range of data values reported first from the whole extent, and then reported by raster itself for the resample data read in.</p>
<p>Now let <code>lazyraster</code> make its own choice about the size of the output. This will be based on the return value of <code><a href="https://rdrr.io/r/grDevices/dev.size.html">dev.size("px")</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">## note how we actually resample up because this data is not very large</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(lazy)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; class      : RasterLayer </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; dimensions : 480, 672, 322560  (nrow, ncol, ncell)</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; resolution : 0.01489583, 0.04171065  (x, y)</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; extent     : 140, 150.01, -60.01833, -39.99722  (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; crs        : NA </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; source     : memory</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; names      : layer </span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; values     : -3.4e+38, 289.859  (min, max)</span></a></code></pre></div>
<p>More concretely, if we open a graphics device at a given size the raster data read in will match it. (This is not the best choice but works fine for demonstration and experimenting.)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## what do we get if we set up a bitmap device</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">tf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(<span class="dt">fileext =</span> <span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span>(tf, <span class="dt">height =</span> <span class="dv">50</span>, <span class="dt">width =</span> <span class="dv">40</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(lazy)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; class      : RasterLayer </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; dimensions : 50, 40, 2000  (nrow, ncol, ncell)</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; resolution : 0.25025, 0.4004222  (x, y)</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; extent     : 140, 150.01, -60.01833, -39.99722  (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; crs        : NA </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; source     : memory</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; names      : layer </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; values     : -3.4e+38, 289.815  (min, max)</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#plot(as_raster(lazy))</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; png </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;   2</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span>(tf)</a></code></pre></div>
<p>This will work on really big files.</p>
<p>(This example can’t work on your computer probably given use of local raadtools, but try it on your favourite big file).</p>
<p>This takes a fairly large grid and plots just enough detail by reading just enough detail for the plot space. That’s all that happens.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(raadtools)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Loading required package: raster</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; Loading required package: sp</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; global option 'raadfiles.data.roots' set:</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; '/rdsi/PRIVATE/raad/data               2019-10-03 12:35:12</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;  /rdsi/PRIVATE/raad/data_local         2019-10-03 12:35:53</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  /rdsi/PRIVATE/raad/data_staging       2019-10-03 12:35:54</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  /rdsi/PRIVATE/raad/data_deprecated    2019-10-03 12:39:49</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  /rdsi/PUBLIC/raad/data                2019-10-03 10:53:19'</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; Uploading raad file cache as at 2019-10-03 12:41:12 (1017941 files listed)</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">f &lt;-<span class="st"> </span>raadtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raadtools/man/readtopo.html">topofile</a></span>(<span class="st">"gebco_14"</span>)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="kw"><a href="reference/lazyraster.html">lazyraster</a></span>(f)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; class         : LazyRaster</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; dimensions    : 21600, 43200 (nrow, ncol)</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; resolution    : 0.008333333, 0.008333333 (x, y)</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; extent        : -180.0000,  180.0000,  -90.0000,   90.0000 (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; crs           : &lt;placeholder&gt;</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; values        : NA, NA (min, max - range from entire extent)</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; window extent : &lt;whole extent&gt;</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; window index  : &lt;-&gt;</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(raster)</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">op &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">0</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">  rworld &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster.html">lazyraster</a></span>(f)</a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(rworld, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">100</span>)), <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">asp =</span> <span class="st">""</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">})</a></code></pre></div>
<p><img src="reference/figures/README-raadtools-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt;   0.763   0.109   0.976</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</a></code></pre></div>
<p>Now, plot the same kind of image but zoom in on a region purposefully. The resolution provided has adapted to the context asked for.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">rtas &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster-raster-S4.html">crop</a></span>(rworld, <span class="kw"><a href="reference/lazyraster-raster-S4.html">extent</a></span>(<span class="fl">143.4</span>, <span class="dv">149</span>, <span class="dv">-44</span>, <span class="fl">-39.1</span>))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(rtas, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">64</span>)), <span class="dt">zlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1550</span>))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">rbath &lt;-<span class="st"> </span><span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(rtas)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">rbath[rbath <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/contour.html">contour</a></span>(rbath, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span>(rbath, <span class="dt">prob =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">8</span>)))</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"Tasmania topography + bathymetric contours, from Gebco 2014"</span>, <span class="dt">cex.main =</span> <span class="fl">0.85</span>)</a></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-1-1.png" width="100%"></p>
<p>This is not just to plot big rasters, it’s potentially useful for streaming gridded data to a device that is resizing the view port interactively. We also use it to explore a data set for useability and general coverage, and designing sensible resampling workflows for very large data models.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">## PLEASE take care with this url, it is a 11Gb GeoTIFF</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">## https://astrogeology.usgs.gov/search/map/Mars/Topography/HRSC_MOLA_Blend/Mars_HRSC_MOLA_BlendDEM_Global_200mp_v2</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">dangerurl &lt;-<span class="st"> "https://planetarymaps.usgs.gov/mosaic/Mars/HRSC_MOLA_Blend/Mars_HRSC_MOLA_BlendDEM_Global_200mp_v2.tif"</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">## note prefix with GDAL's URL indirection</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">mars &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster.html">lazyraster</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/vsicurl"</span>, dangerurl))</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">mars</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; class         : LazyRaster</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; dimensions    : 53347, 106694 (nrow, ncol)</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; resolution    : 0.003374121, 0.003374121 (x, y)</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; extent        : -180.00000,  179.99845,  -89.99922,   90.00000 (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; crs           : &lt;placeholder&gt;</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; values        : NA, NA (min, max - range from entire extent)</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; window extent : &lt;whole extent&gt;</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; window index  : &lt;-&gt;</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(mars, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">256</span>)))</a></code></pre></div>
<p><img src="reference/figures/README-mars-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(mars)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; class      : RasterLayer </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; dimensions : 480, 672, 322560  (nrow, ncol, ncell)</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; resolution : 0.535712, 0.3749984  (x, y)</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; extent     : -180, 179.9984, -89.99922, 90  (xmin, xmax, ymin, ymax)</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; crs        : NA </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; source     : memory</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; names      : layer </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; values     : -7716, 20910  (min, max)</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw"><a href="reference/lazyraster-raster-S4.html">crop</a></span>(mars, raster<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">-30</span>, <span class="dv">-18</span>, <span class="dv">5</span>)), </a>
<a class="sourceLine" id="cb9-12" data-line-number="12">     <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">256</span>)))</a></code></pre></div>
<p><img src="reference/figures/README-mars-2.png" width="100%"></p>
<p>We’ve successfully used it to plot a DEM of Australia from a 67 Gb ESRI binary grid (ADF) supplied by GeoScience Australia in <em>a few minutes</em> (the grid is more than 1e5 pixels each dimension, so I’m not having this document build do the job but here’s a figure I prepared earlier).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">gafile &lt;-<span class="st"> </span>raadtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raadtools/man/readtopo.html">topofile</a></span>(<span class="st">"ga_srtm"</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">ga &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster.html">lazyraster</a></span>(gafile)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">ga</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(ga)</a></code></pre></div>
<p><img src="inst/images/ga_srtm.png" title="GeoScience SRTM" alt="GeoScience SRTM"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Make a TMS source and read at the desired resolution. </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co"># More here: http://rpubs.com/cyclemumner/358029</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lazyraster)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">gibs_xml &lt;-<span class="st"> </span><span class="cf">function</span>(date, <span class="dt">level =</span> <span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  date &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(date, <span class="st">"%Y-%m-%d"</span>)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">'&lt;GDAL_WMS&gt;</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">         &lt;Service name="TMS"&gt;</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">         &lt;ServerUrl&gt;</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">         https://gibs.earthdata.nasa.gov/wmts/epsg3413/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/%s/250m/${z}/${y}/${x}.jpg&lt;/ServerUrl&gt;</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="st">         &lt;/Service&gt;</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">         &lt;DataWindow&gt;</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="st">         &lt;UpperLeftX&gt;-4194304&lt;/UpperLeftX&gt;</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="st">         &lt;UpperLeftY&gt;4194304&lt;/UpperLeftY&gt;</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="st">         &lt;LowerRightX&gt;4194304&lt;/LowerRightX&gt;</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="st">         &lt;LowerRightY&gt;-4194304&lt;/LowerRightY&gt;</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="st">         &lt;TileLevel&gt;%i&lt;/TileLevel&gt;</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="st">         &lt;TileCountX&gt;2&lt;/TileCountX&gt;</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="st">         &lt;TileCountY&gt;2&lt;/TileCountY&gt;</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="st">         &lt;YOrigin&gt;top&lt;/YOrigin&gt;</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="st">         &lt;/DataWindow&gt;</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="st">         &lt;Projection&gt;EPSG:3413&lt;/Projection&gt;</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="st">         &lt;BlockSizeX&gt;512&lt;/BlockSizeX&gt;</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="st">         &lt;BlockSizeY&gt;512&lt;/BlockSizeY&gt;</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="st">         &lt;BandsCount&gt;3&lt;/BandsCount&gt;</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="st">         &lt;/GDAL_WMS&gt;</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="st">         '</span>, date, level)</a>
<a class="sourceLine" id="cb11-29" data-line-number="29">}</a>
<a class="sourceLine" id="cb11-30" data-line-number="30"></a>
<a class="sourceLine" id="cb11-31" data-line-number="31">s &lt;-<span class="st"> </span><span class="kw">gibs_xml</span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>()<span class="op">-</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb11-32" data-line-number="32">gibs &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster.html">lazyraster</a></span>(s)</a>
<a class="sourceLine" id="cb11-33" data-line-number="33">r2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(gibs, <span class="dt">dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">150</span>, <span class="dv">150</span>))</a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(raster)</a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">## run the same simplification but with a different resampling </span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="co">## method</span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(gibs, <span class="dt">dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">150</span>, <span class="dv">150</span>), <span class="dt">resample =</span> <span class="st">"CubicSpline"</span>), <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span>(palr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/palr/man/sstPal.html">sstPal</a></span>(<span class="dv">64</span>), <span class="dv">45</span>))</a></code></pre></div>
<p><img src="reference/figures/README-tms-1.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">## run with a different extent</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">e &lt;-<span class="st"> </span><span class="kw"><a href="reference/lazyraster-raster-S4.html">extent</a></span>(<span class="op">-</span><span class="dv">806000</span>, <span class="dv">1080000</span>, <span class="dv">-3200000</span>, <span class="dv">-500000</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="kw"><a href="reference/as_raster.html">as_raster</a></span>(<span class="kw"><a href="reference/lazyraster-raster-S4.html">crop</a></span>(gibs, e), <span class="dt">dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">150</span>, <span class="dv">150</span>), <span class="dt">resample =</span> <span class="st">"CubicSpline"</span>), <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span>(palr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/palr/man/sstPal.html">sstPal</a></span>(<span class="dv">64</span>), <span class="dv">45</span>))</a></code></pre></div>
<p><img src="reference/figures/README-tms-2.png" width="100%"></p>
<p>Please note that this project is released with a <a href="https://github.com/hypertidy/lazyraster/blob/master/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/hypertidy/lazyraster">https://​github.com/​hypertidy/​lazyraster</a>
</li>
<li>Report a bug at <br><a href="https://github.com/hypertidy/lazyraster/issues">https://​github.com/​hypertidy/​lazyraster/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Michael Sumner <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/hypertidy/lazyraster"><img src="http://badges.herokuapp.com/travis/hypertidy/lazyraster?branch=master&amp;env=BUILD_NAME=xenial_release&amp;label=linux" alt="Travis-CI Build Status"></a></li>
<li><a href="https://travis-ci.org/hypertidy/lazyraster"><img src="http://badges.herokuapp.com/travis/hypertidy/lazyraster?branch=master&amp;env=BUILD_NAME=osx_release&amp;label=osx" alt="Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/mdsumner/lazyraster"><img src="https://ci.appveyor.com/api/projects/status/github/hypertidy/lazyraster?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://codecov.io/github/hypertidy/lazyraster?branch=master"><img src="https://codecov.io/gh/hypertidy/lazyraster/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#maturing"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="lifecycle"></a></li>
<li><a href="https://cran.r-project.org/package=lazyraster"><img src="http://www.r-pkg.org/badges/version/lazyraster" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://cran.r-project.org/package=lazyraster"><img src="http://cranlogs.r-pkg.org/badges/lazyraster" alt="CRAN_Download_Badge"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
